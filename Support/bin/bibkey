#!/usr/bin/ruby

## get a sorted list of cite keys that match an array of strings
##
## bibkey path/to/bibtex string1 string2 ...

def extractcitekeys(somestrings,text)
  keys = []
  somestrings.each { |match| 
    match.chomp
    keys = keys + text.scan(/@.*?\{(#{match}.*?),/i)
  }
  keys.uniq!
  keys.sort!
  return keys
end

strings=ARGV
bib=strings.shift
if File.readable?(bib) then
  File.open(bib) { |file|
      mytext = file.read
      mykeys = extractcitekeys(strings,mytext)
      puts mykeys
  }
end
